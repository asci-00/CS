# μΈν„°λ½νΈμ™€ μ‹μ¤ν…μ½
### λ©μ°¨
- μΈν„°λ½νΈ
- μ‹μ¤ν…μ½

<br/><br/>

---

## μΈν„°λ½νΈ
### μΈν„°λ½νΈλ€?
> ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•λ” λ„μ¤‘μ— μκΈ°μΉ μ•μ€ μƒν™©μ΄ λ°μƒν•  κ²½μ° ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ μ‘μ—…μ„ μ¦‰μ‹ μ¤‘λ‹¨ν•κ³ , λ°μƒλ μƒν™©μ— λ€ν• μ°μ„  μ²λ¦¬κ°€ ν•„μ”ν•¨μ„ CPUμ—κ² μ•λ¦¬λ” κ²ƒ
>
> ν„μ¬ μν–‰ μ¤‘μΈ μ‘μ—…λ³΄λ‹¤ μ¤‘μ”ν• μΌ (ex. μ…μ¶λ ¥, μ°μ„  μμ„ μ—°μ‚° λ“±)μ΄ λ°μƒν•λ©΄ ν•΄λ‹Ή μ‘μ—…μ„ λ¨Όμ € μ²λ¦¬
>
> μΆ…λ¥λ΅λ” μ™Έλ¶€ μΈν„°λ½νΈμ™€ λ‚΄λ¶€ μΈν„°λ½νΈκ°€ μ΅΄μ¬

#### μ™Έλ¶€ μΈν„°λ½νΈ

> μ…μ¶λ ¥ μ¥μΉ, νƒ€μ΄λ° μ¥μΉ, μ „μ› λ“±μ μ™Έλ¶€μ μΈ μ”μΈμΌλ΅ CPUμ ν•λ“μ›¨μ–΄ μ‹ νΈμ— μν•΄ λ°μƒ
> 
> ex) μ „μ› μ΄μƒ, κΈ°κ³„ μ°©μ¤, μ™Έλ¶€ μ‹ νΈ, μ…μ¶λ ¥
#### λ‚΄λ¶€ μΈν„°λ½νΈ

> Trapμ΄λΌκ³  λ¶€λ¥΄λ©°, μλ»λ λ…λ Ήμ΄λ‚ λ°μ΄ν„° μ‚¬μ©κ°™μ€ λ…λ Ήμ–΄μ μν–‰μ— μν•΄ λ°μƒ
> 
> μ†ν”„νΈμ›¨μ–΄(μ‚¬μ©μ ν”„λ΅κ·Έλ¨)κ°€ μ¤μ¤λ΅ μΈν„°λ½νΈ λΌμΈμ„ μ„Έν…
> 
> ex) 0μΌλ΅ λ‚λ„κΈ°κ°€ λ°μƒ, μ¤λ²„ν”λ΅μ°, λ…λ Ήμ–΄λ¥Ό μλ» μ‚¬μ©ν• κ²½μ° (Exception)

#### μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ

> ν”„λ΅κ·Έλ¨ μ²λ¦¬ μ¤‘ λ…λ Ήμ μ”μ²­μ— μν•΄ λ°μƒν• κ²ƒ (SVC μΈν„°λ½νΈ)
> 
> ex) ν”„λ΅μ„Έμ¤ μν–‰ μ¤‘ λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤λ¥Ό μ‹¤ν–‰μ‹ν‚¤λ©΄ μ‹λ¶„ν•  μ²λ¦¬λ¥Ό μ„ν•΄ μμ› ν• λ‹Ή λ™μ‘μ΄ μν–‰

### κ³Όμ •

1. ν„μ¬ μν–‰ μ¤‘μΈ ν”„λ΅μ„Έμ¤λ¥Ό λ©μ¶”κ³ , μƒνƒ λ μ§€μ¤ν„°μ™€ PC λ“±μ„ ν•΄λ‹Ή ν”„λ΅μ„Έμ¤μ PCBμ— μ €μ¥
2. *μΈν„°λ½νΈ λ²΅ν„°*λ¥Ό ν†µν•΄ ISR (Interrupt Service Routine) μ£Όμ†κ°’μ„ μ½μ–΄ μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄μ— μ§„μ…
3. μΈν„°λ½νΈ μ‘μ—… μ²λ¦¬
4. μ΄μ „μ— μ‘μ—…ν–λ ν”„λ΅μ„Έμ¤μ λ μ§€μ¤ν„° λ³µμ›
5. ISRμ λμ— IRET λ…λ Ήμ–΄μ— μν•΄ μΈν„°λ½νΈκ°€ ν•΄μ 
6. PC κ°’μ„ λ³µμ›ν•μ—¬ μ΄μ „ μ‹¤ν–‰ μ„μΉλ΅ λ³µκ·€

> μΈν„°λ½νΈ λ²΅ν„° : μΈν„°λ½λ“ λ°μƒμ‹ μ²λ¦¬ν•΄μ•Ό ν•  μΈν„°λ½νΈ ν•Έλ“¤λ¬μ μ£Όμ†λ¥Ό μΈν„°λ½νΈ λ³„λ΅ λ³΄κ΄€ν•κ³  μλ” ν…μ΄λΈ”
> 
> Q. μΈν„°λ½νΈκ°€ μ΅΄μ¬ν•λ” μ΄μ λ” λ¬΄μ—‡μΈκ°€μ”?
> 
> A. ν•λ“μ›¨μ–΄μ—μ„ μΈν„°λ½νΈ κΈ°λ¥μ„ μ§€μ›ν•μ§€ μ•λ”λ‹¤λ©΄, *ν΄λ§ λ°©μ‹*μ„ ν†µν•΄ μ°μ„ μμ„κ°€ λ†’μ€ μ‘μ—…μ„ μ°Ύμ•„ μ²λ¦¬ν•΄μ•Ό ν•©λ‹λ‹¤.
> μ΄λ” μΈν„°λ½νΈμ— λΉ„ν•΄ μ†λ„μ™€ μ„±λ¥ λ° μ²λ¦¬λ‰ ν¨μ¨μ΄ μΆ‹μ§€ λ»ν•¨ 

<pre>
π“‘ ν΄λ§ λ°©μ‹
- μ‚¬μ©μκ°€ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄ μ…λ ¥ ν•€μ κ°’μ„ κ³„μ† μ½μ–΄ λ³€ν™”λ¥Ό μ•μ•„λ‚΄λ” λ°©μ‹
- μΈν„°λ½νΈ μ”μ²­ ν”λκ·Έλ¥Ό μ°¨λ΅€λ΅ λΉ„κµν•μ—¬ μ°μ„ μμ„κ°€ κ°€μ¥ λ†’μ€ μΈν„°λ½νΈ μμ›μ„ μ°Ύμ•„ 
  μ΄μ— λ§λ” μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄μ„ μν–‰
</pre>


<br/><br/>

---

## μ‹μ¤ν…μ½

### System Callμ΄λ€?
> μ‹μ¤ν… νΈμ¶μ„ μλ―Έν•λ©°, 
> 
> λ…λ Ήμ–΄λ” ν¬κ² 
> 
> λ©”λ¨λ¦¬μ—μ„ μλ£λ¥Ό μ½μ–΄μ¤κ³ , CPUμ—μ„ κ³„μ‚°μ„ ν•λ” λ“±μ `μΌλ°λ…λ Ή`κ³Ό 
> 
> λ³΄μ•μ΄ ν•„μ”ν• λ…λ ΉμΌλ΅ μ…μ¶λ ¥ μ¥μΉ, νƒ€μ΄λ¨Έ λ“±μ μ¥μΉλ¥Ό μ ‘κ·Όν•λ” `νΉκ¶λ…λ Ή` *Privileged Instruction* μ΄ μ΅΄μ¬ν•λ”λ°,
> 
> μΌλ°λ…λ Ήμ€ λ¨λ“  ν”„λ΅κ·Έλ¨μ΄ μ‚¬μ©ν•  μ μμΌλ‚, νΉκ¶λ…λ Ήμ€ μ΄μμ²΄μ λ§μ΄ μ‚¬μ©μ΄ κ°€λ¥
>
> μ΄μμ²΄μ λ” ν•λ“μ›¨μ–΄ λ³΄μ•μ„μ μ§€ν•κΈ° μ„ν•΄ νΉκ¶λ…λ Ήμ„ μ‚¬μ©ν•  μ μλ” `kernel mode`μ™€ μΌλ°λ…λ Ήλ§μ„ μ‚¬μ©ν•  μ μλ” 
> 
> `user mode`λ΅ λ‘κ°μ operationμ„ μ§€μ›
> 
> System call μ΄λ€ user mode λ΅ λ™μ‘ν•λ” ν”„λ΅μ„Έμ¤κ°€ νΉκ¶λ…λ Ήμ„ μν–‰ν•κΈ° μ„ν•΄ μ΄μμ²΄μ μ— μ”μ²­ν•λ” ν–‰μ„λ¥Ό μλ―Έ

### μ›λ¦¬

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile22.uf.tistory.com%2Fimage%2F25333241535CCEE810F365)

### μΆ…λ¥

> ν”„λ΅κ·Έλλ°μ—μ„ Systemcall ν•¨μλ” μΆ…λ¥λ”
> 
> ν° λ²”μ£Όλ΅ λ‚λκ²½μ° ν”„λ΅μ„Έμ¤ μ μ–΄, νμΌ μ΅°μ‘, μ¥μΉ μ΅°μ‘, μ •λ³΄ μ μ§€λ³΄μ, ν†µμ‹ κ³Ό λ³΄νΈκ°€ μ΅΄μ¬
> 
> μ—¬κΈ°μ„λ” ν”„λ΅μ„Έμ¤ μ μ–΄ μ¤‘ μμ£Ό μ‚¬μ©λλ” λ‡κ°€μ§€λ¥Ό μ¶”λ ¤ μ„¤λ…ν•¨

#### fork

> μƒλ΅μ΄ μμ‹ ν”„λ΅μ„Έμ¤λ¥Ό μƒμ„±ν•λ” SystamCall ν•¨μ

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    printf("pid : %d", (int) getpid()); // pid : 29146
    
    int rc = fork();
    
    if (rc < 0) exit(1); //fork μ‹¤ν¨
    else if (rc == 0) printf("child (pid : %d)", (int) getpid());   //μμ‹ ν”„λ΅μ„Έμ¤μ κ²½μ° fork return = 0
    else printf("parent of %d (pid : %d)", rc, (int)getpid());      //λ¶€λ¨ ν”„λ΅μ„Έμ¤μ κ²½μ° fork return = child pid
        
    return 0;
}

```

> ν”„λ΅μ„Έμ¤μ μν–‰ μμ„λ” λ¶€λ¨-μμ‹ κ΄€κ³„μ— μν–¥μ„ λ°›μ§€ μ•μ
> 
> λ¶€λ¨ ν”„λ΅μ„Έμ¤κ°€ μμ‹ ν”„λ΅μ„Έμ¤λ³΄λ‹¤ λ¨Όμ € μΆ…λ£λ  μ μμ


#### exec

> ν•΄λ‹Ή ν”„λ΅μ„Έμ¤μ μ΄λ―Έμ§€λ¥Ό ν•¨μμ μΈμλ΅ μ „λ‹¬λλ” ν”„λ΅κ·Έλ¨μ μ΄λ―Έμ§€λ΅ λ®μ–΄μ”μ›€
> 
> ν•΄λ‹Ή λ…λ Ήμ–΄ or ν”„λ΅κ·Έλ¨μ codeμμ—­μ„ λ®μ–΄ μ”μ°κ³ , heap, stack λ“±μ λ©”λ¨λ¦¬ μμ—­μ„ μ΄κΈ°ν™”
> 
> exec κ³„μ—΄μ€ μ—¬λ¬ μΆ…λ¥μ ν•¨μκ°€ μ΅΄μ¬ν•¨

| ν•¨μ μ΄λ¦„	| ν”„λ΅κ·Έλ¨ μ§€μ •	| λ…λ ΉλΌμΈ μΈμ	| ν•¨μ μ„¤λ… |
|---|---|---|---|
| execl	| λ””λ ‰ν† λ¦¬μ™€ νμΌ μ΄λ¦„μ΄ ν•©μΉ μ „μ²΄ μ΄λ¦„	| μΈμ λ¦¬μ¤νΈ	| ν™κ²½ μ„¤μ • λ¶κ°€  |
| execlp |	νμΌ μ΄λ¦„| 	μΈμ λ¦¬μ¤νΈ| 	ν™κ²½ μ„¤μ • λ¶κ°€ |
| execle |	λ””λ ‰ν† λ¦¬μ™€ νμΌ μ΄λ¦„μ΄ ν•©μΉ μ „μ²΄ μ΄λ¦„| 	μΈμ λ¦¬μ¤νΈ| 	ν™κ²½ μ„¤μ • κ°€λ¥ |
| execv |	λ””λ ‰ν† λ¦¬μ™€ νμΌ μ΄λ¦„μ΄ ν•©μΉ μ „μ²΄ μ΄λ¦„| 	μΈμ λ°°μ—΄| 	ν™κ²½ μ„¤μ • λ¶κ°€ |
| execvp |	νμΌ μ΄λ¦„	| μΈμ λ°°μ—΄| ν™κ²½ μ„¤μ • λ¶κ°€ |
| excve |	μ „μ  κ²½λ΅ λ…| 	μΈμ λ°°μ—΄	| ν™κ²½ μ„¤μ • κ°€λ¥ |

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main(int argc, char *argv[]) {
    char *command[3] = {
      "ls",   //μ‹¤ν–‰ν•  λ…λ Ήμ–΄ or ν”„λ΅κ·Έλ¨ μ΄λ¦„
      "a", //ν•΄λ‹Ή ν”„λ΅κ·Έλ¨μ— μ „λ‹¬λ  μΈμ
      NULL    //end ν‘μ‹
    };
    execvp(command[0], command);		   // ν•΄λ‹Ή ν”„λ΅κ·Έλ¨ μ΄λ―Έμ§€λ¥Ό λ®μ–΄μ”μ›€
    printf("this shouldn't print out") // μ‹¤ν–‰λμ§€ μ•μ.
    return 0;
}
```

#### wait

> μμ‹ ν”„λ΅μ„Έμ¤λ¥Ό μƒμ„±ν•μ€μ„λ•, λ¶€λ¨ ν”„λ΅μ„Έμ¤μ—μ„ μμ‹ν”„λ΅μ„Έμ¤μ μΆ…λ£λ¥Ό κΈ°λ‹¤λ¦Ό
> wait ν•¨μμ return κ°’μ€ childμ pid μ΄λ©° μΈμλ΅λ” child ν”„λ΅μ„Έμ¤μ return κ°’μ„ λ°›μ„ μ μλ” λ³€μμ μ£Όμ†κ°’μ„ λ„£μ–΄μ¤

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    printf("pid : %d", (int) getpid()); // pid : 29146
    
    int rc = fork();
    
    if (rc < 0) exit(1); //fork μ‹¤ν¨
    else if (rc == 0) printf("child (pid : %d)", (int) getpid());   //μμ‹ ν”„λ΅μ„Έμ¤μ κ²½μ° fork return = 0
    else {
      int cpid = wait(NULL);  //μ—¬κΈ°μ„ μμ‹ ν”„λ΅μ„Έμ¤κ°€ μΆ…λ£λ λ•κΉμ§€ block λ¨ 
      printf("parent of %d / %d (pid : %d)", cpid, rc, (int)getpid());
    }
        
    return 0;
}

```

### μ¶μ²

#### μ΄λ―Έμ§€
- https://luckyyowu.tistory.com/133
